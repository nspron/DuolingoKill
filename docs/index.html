<!DOCTYPE html>
<html>
<head>
    <title>Daily Open Statistics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .chart-container {
            width: 80%;
            margin: 20px auto;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        table {
            width: 80%;
            margin: 20px auto;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
    </style>
</head>
<body>
    <h1>Daily Open Statistics</h1>
    
    <div class="chart-container">
        <h2>Unique Devices Per Day</h2>
        <canvas id="devicesChart" height="200"></canvas>
    </div>
    
    <table id="statsTable">
        <thead>
            <tr>
                <th>Date</th>
                <th>Device ID</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
    
    <script>
        fetch('https://raw.githubusercontent.com/你的用户名/你的仓库名/main/stats/daily_opens.csv')
            .then(response => response.text())
            .then(data => {
                const rows = data.split('\n').filter(row => row.trim() !== '');
                const headers = rows.shift().split(',');
                
                // 准备数据
                const stats = rows.map(row => {
                    const values = row.split(',');
                    const entry = {};
                    headers.forEach((header, i) => {
                        entry[header] = values[i];
                    });
                    return entry;
                });
                
                // 按日期统计设备数
                const dailyCounts = {};
                stats.forEach(stat => {
                    if (!dailyCounts[stat.date]) {
                        dailyCounts[stat.date] = 0;
                    }
                    dailyCounts[stat.date]++;
                });
                
                const dates = Object.keys(dailyCounts).sort();
                const counts = dates.map(date => dailyCounts[date]);
                
                // 绘制图表
                new Chart(
                    document.getElementById('devicesChart'),
                    {
                        type: 'bar',
                        data: {
                            labels: dates,
                            datasets: [{
                                label: 'Unique Devices',
                                data: counts,
                                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                                borderColor: 'rgb(54, 162, 235)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    precision: 0
                                }
                            }
                        }
                    }
                );
                
                // 填充表格
                const tbody = document.querySelector('#statsTable tbody');
                stats.forEach(stat => {
                    const tr = document.createElement('tr');
                    headers.forEach(header => {
                        const td = document.createElement('td');
                        td.textContent = stat[header] || '-';
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });
            })
            .catch(error => {
                console.error('Error loading stats:', error);
                document.body.innerHTML += '<p>Error loading data. Please try again later.</p>';
            });
    </script>
</body>
</html>
